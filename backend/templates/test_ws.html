<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Chat Test</title>
</head>
<body>
    <h1>Test WebSocket</h1>
    
    <label>Chat ID:</label>
    <input id="chat-id" placeholder="Chat ID" value="1">
    <button onclick="connectWS()">🔌 Connect</button>
    <br><br>

    <textarea id="log" rows="15" cols="60" readonly></textarea><br>
    
    <input id="message-input" type="text" placeholder="Enter message">
    <button onclick="sendMessage()">📨 Send</button>

    <script>
        let socket;

        function log(msg) {
            const logArea = document.getElementById("log");
            logArea.value += msg + "\n";
            logArea.scrollTop = logArea.scrollHeight;
        }

        function connectWS() {
            const chatId = document.getElementById("chat-id").value;
            const url = `ws://${window.location.host}/ws/chat/${chatId}/`;

            socket = new WebSocket(url);

            socket.onopen = () => log("✅ WebSocket connected to " + url);
            socket.onmessage = (e) => {
                try {
                    const data = JSON.parse(e.data);
                    log(`📥 ${data.message}`);
                } catch (err) {
                    log("⚠️ Error parsing message: " + e.data);
                }
            };
            socket.onclose = () => log("❌ WebSocket connection closed");
            socket.onerror = (e) => log("⚠️ WebSocket error: " + e.message);
        }

        function sendMessage() {
            const messageInput = document.getElementById("message-input");
            const message = messageInput.value.trim();

            if (!message || socket.readyState !== WebSocket.OPEN) {
                log("⚠️ Cannot send message: WebSocket is not open or message is empty");
                return;
            }

            const data = { message: message };
            socket.send(JSON.stringify(data));
            log("📤 Sent: " + message);
            messageInput.value = "";
        }
    </script>
</body>
</html>
